<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport d'Audit de S√©curit√© - {{ audit_metadata.client_name }}</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>

<!-- Couverture -->
<div class="cover-page">
    {% if logo_path %}
    <img src="{{ logo_path }}" alt="Logo" style="max-width: 200px; margin-bottom: 30px;">
    {% endif %}
    <h1>Rapport d'Audit de S√©curit√©</h1>
    <h2>{{ audit_metadata.audit_type }}</h2>
    <div class="metadata">
        <p><strong>Client:</strong> {{ audit_metadata.client_name }}</p>
        <p><strong>P√©riode:</strong> {{ audit_metadata.audit_date }} - {{ audit_metadata.audit_end_date }}</p>
        <p><strong>Auditeurs:</strong> {{ audit_metadata.testeurs | join(', ') }}</p>
        <p><strong>Date du rapport:</strong> {{ report_date }}</p>
    </div>
</div>

<!-- Table des mati√®res -->
<div class="toc page-break">
    <h2>Table des Mati√®res</h2>
    <ul>
        <li><a href="#executive-summary">1. R√©sum√© Ex√©cutif</a></li>
        <li><a href="#dashboard">2. Tableau de Bord</a></li>
        <li><a href="#findings">3. D√©tails des Vuln√©rabilit√©s</a></li>
        <li><a href="#findings-by-severity">3.1. Par Niveau de S√©v√©rit√©</a></li>
        <li><a href="#findings-by-type">3.2. Par Type de Vuln√©rabilit√©</a></li>
        {% if include_roadmap %}
        <li><a href="#roadmap">4. Plan de Rem√©diation</a></li>
        {% endif %}
        {% if include_appendix %}
        <li><a href="#appendix">5. Annexes Techniques</a></li>
        {% endif %}
    </ul>
</div>

<!-- Executive Summary -->
<div id="executive-summary" class="section page-break">
    <h1>1. R√©sum√© Ex√©cutif</h1>
    
    <div class="executive-summary">
        <h3>Contexte de la Mission</h3>
        <p>
            Dans le cadre de l'√©valuation de la posture de s√©curit√© de <strong>{{ audit_metadata.client_name }}</strong>,
            notre √©quipe a r√©alis√© un {{ audit_metadata.audit_type }} du {{ audit_metadata.audit_date }} au {{ audit_metadata.audit_end_date }}.
        </p>
        
        <h3>P√©rim√®tre d'Audit</h3>
        <ul>
            {% for scope_item in audit_metadata.scope %}
            <li>{{ scope_item }}</li>
            {% endfor %}
        </ul>
        
        <h3>Synth√®se des R√©sultats</h3>
        <p>
            L'audit a permis d'identifier <strong>{{ summary.total_findings }} vuln√©rabilit√©s</strong> r√©parties comme suit :
        </p>
        <ul>
            <li><strong style="color: #dc3545;">{{ summary.critical }} vuln√©rabilit√©s critiques</strong> n√©cessitant une action imm√©diate</li>
            <li><strong style="color: #fd7e14;">{{ summary.high }} vuln√©rabilit√©s √©lev√©es</strong> √† traiter en priorit√©</li>
            <li><strong style="color: #ffc107;">{{ summary.medium }} vuln√©rabilit√©s moyennes</strong> √† corriger √† moyen terme</li>
            <li><strong style="color: #0dcaf0;">{{ summary.low }} vuln√©rabilit√©s faibles</strong> √† corriger sur le long terme</li>
        </ul>
        
        <h3>Recommandations Prioritaires</h3>
        <p>
            Les vuln√©rabilit√©s critiques et √©lev√©es repr√©sentent un risque significatif pour la s√©curit√© de l'organisation.
            Nous recommandons vivement de traiter ces vuln√©rabilit√©s dans les plus brefs d√©lais.
        </p>
    </div>
</div>

<!-- Dashboard -->
<div id="dashboard" class="section page-break">
    <h1>2. Tableau de Bord</h1>
    
    <h2>Vue d'Ensemble par S√©v√©rit√©</h2>
    <div class="dashboard">
        <div class="stat-card critical">
            <div class="label">Critique</div>
            <div class="number">{{ summary.critical }}</div>
        </div>
        <div class="stat-card high">
            <div class="label">√âlev√©e</div>
            <div class="number">{{ summary.high }}</div>
        </div>
        <div class="stat-card medium">
            <div class="label">Moyenne</div>
            <div class="number">{{ summary.medium }}</div>
        </div>
        <div class="stat-card low">
            <div class="label">Faible</div>
            <div class="number">{{ summary.low }}</div>
        </div>
    </div>
    
    <h2>R√©partition par Outil</h2>
    <table>
        <thead>
            <tr>
                <th>Outil</th>
                <th>Nombre de Findings</th>
            </tr>
        </thead>
        <tbody>
            {% for tool, count in statistics.findings_by_tool.items() %}
            <tr>
                <td>{{ tool }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h2>R√©partition par Type</h2>
    <table>
        <thead>
            <tr>
                <th>Type de Vuln√©rabilit√©</th>
                <th>Nombre de Findings</th>
            </tr>
        </thead>
        <tbody>
            {% for finding_type, count in statistics.findings_by_type.items() %}
            <tr>
                <td>{{ finding_type }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Findings Details -->
<div id="findings" class="section page-break">
    <h1>3. D√©tails des Vuln√©rabilit√©s</h1>
    
    <div id="findings-by-severity">
        <h2>3.1. Classement par Niveau de S√©v√©rit√©</h2>
        
        <!-- Critical Findings -->
        {% set critical_findings = findings | selectattr('severity', 'equalto', 'critical') | list %}
        {% if critical_findings %}
        <h3>Vuln√©rabilit√©s Critiques ({{ critical_findings | length }})</h3>
        {% for finding in critical_findings %}
        <div class="finding critical">
            <div class="finding-header">
                <div>
                    <span class="finding-id">{{ finding.id }}</span>
                    <div class="finding-title">{{ finding.title }}</div>
                </div>
                <div>
                    <span class="severity-badge critical">Critique</span>
                    {% if finding.cvss_score %}
                    <span class="cvss-score">CVSS {{ finding.cvss_score }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="finding-meta">
                <div class="meta-item">
                    <span class="meta-label">Type:</span> {{ finding.finding_type }}
                </div>
                {% if finding.cve_ids %}
                <div class="meta-item">
                    <span class="meta-label">CVE:</span> {{ finding.cve_ids | join(', ') }}
                </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-label">Statut:</span> {{ finding.status }}
                </div>
            </div>
            
            <div class="finding-content">
                <div class="finding-section">
                    <h4>üìã Description</h4>
                    <p>{{ finding.description }}</p>
                </div>
                
                {% if finding.business_impact %}
                <div class="finding-section">
                    <h4>üíº Impact M√©tier</h4>
                    <p>{{ finding.business_impact }}</p>
                </div>
                {% endif %}
                
                {% if finding.affected_assets %}
                <div class="finding-section">
                    <h4>üéØ Actifs Affect√©s</h4>
                    <ul>
                        {% for asset in finding.affected_assets %}
                        <li>{{ asset }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <div class="finding-section">
                    <h4>üîß Rem√©diation</h4>
                    <p>{{ finding.remediation }}</p>
                </div>
                
                {% if finding.evidence %}
                <div class="finding-section">
                    <h4>üîç Preuve Technique</h4>
                    <div class="evidence">{{ finding.evidence }}</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- High Findings -->
        {% set high_findings = findings | selectattr('severity', 'equalto', 'high') | list %}
        {% if high_findings %}
        <h3>Vuln√©rabilit√©s √âlev√©es ({{ high_findings | length }})</h3>
        {% for finding in high_findings %}
        <div class="finding high">
            <div class="finding-header">
                <div>
                    <span class="finding-id">{{ finding.id }}</span>
                    <div class="finding-title">{{ finding.title }}</div>
                </div>
                <div>
                    <span class="severity-badge high">√âlev√©e</span>
                    {% if finding.cvss_score %}
                    <span class="cvss-score">CVSS {{ finding.cvss_score }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="finding-meta">
                <div class="meta-item">
                    <span class="meta-label">Type:</span> {{ finding.finding_type }}
                </div>
                {% if finding.cve_ids %}
                <div class="meta-item">
                    <span class="meta-label">CVE:</span> {{ finding.cve_ids | join(', ') }}
                </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-label">Statut:</span> {{ finding.status }}
                </div>
            </div>
            
            <div class="finding-content">
                <div class="finding-section">
                    <h4>üìã Description</h4>
                    <p>{{ finding.description }}</p>
                </div>
                
                {% if finding.business_impact %}
                <div class="finding-section">
                    <h4>üíº Impact M√©tier</h4>
                    <p>{{ finding.business_impact }}</p>
                </div>
                {% endif %}
                
                {% if finding.affected_assets %}
                <div class="finding-section">
                    <h4>üéØ Actifs Affect√©s</h4>
                    <ul>
                        {% for asset in finding.affected_assets %}
                        <li>{{ asset }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <div class="finding-section">
                    <h4>üîß Rem√©diation</h4>
                    <p>{{ finding.remediation }}</p>
                </div>
                
                {% if finding.evidence %}
                <div class="finding-section">
                    <h4>üîç Preuve Technique</h4>
                    <div class="evidence">{{ finding.evidence }}</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- Medium Findings -->
        {% set medium_findings = findings | selectattr('severity', 'equalto', 'medium') | list %}
        {% if medium_findings %}
        <h3>Vuln√©rabilit√©s Moyennes ({{ medium_findings | length }})</h3>
        {% for finding in medium_findings %}
        <div class="finding medium">
            <div class="finding-header">
                <div>
                    <span class="finding-id">{{ finding.id }}</span>
                    <div class="finding-title">{{ finding.title }}</div>
                </div>
                <div>
                    <span class="severity-badge medium">Moyenne</span>
                    {% if finding.cvss_score %}
                    <span class="cvss-score">CVSS {{ finding.cvss_score }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="finding-meta">
                <div class="meta-item">
                    <span class="meta-label">Type:</span> {{ finding.finding_type }}
                </div>
                {% if finding.cve_ids %}
                <div class="meta-item">
                    <span class="meta-label">CVE:</span> {{ finding.cve_ids | join(', ') }}
                </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-label">Statut:</span> {{ finding.status }}
                </div>
            </div>
            
            <div class="finding-content">
                <div class="finding-section">
                    <h4>üìã Description</h4>
                    <p>{{ finding.description }}</p>
                </div>
                
                <div class="finding-section">
                    <h4>üîß Rem√©diation</h4>
                    <p>{{ finding.remediation }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- Low Findings -->
        {% set low_findings = findings | selectattr('severity', 'equalto', 'low') | list %}
        {% if low_findings %}
        <h3>Vuln√©rabilit√©s Faibles ({{ low_findings | length }})</h3>
        {% for finding in low_findings %}
        <div class="finding low">
            <div class="finding-header">
                <div>
                    <span class="finding-id">{{ finding.id }}</span>
                    <div class="finding-title">{{ finding.title }}</div>
                </div>
                <div>
                    <span class="severity-badge low">Faible</span>
                    {% if finding.cvss_score %}
                    <span class="cvss-score">CVSS {{ finding.cvss_score }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="finding-meta">
                <div class="meta-item">
                    <span class="meta-label">Type:</span> {{ finding.finding_type }}
                </div>
            </div>
            
            <div class="finding-content">
                <div class="finding-section">
                    <h4>üìã Description</h4>
                    <p>{{ finding.description }}</p>
                </div>
                
                <div class="finding-section">
                    <h4>üîß Rem√©diation</h4>
                    <p>{{ finding.remediation }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
</div>

<!-- Roadmap -->
{% if include_roadmap %}
<div id="roadmap" class="section page-break">
    <h1>4. Plan de Rem√©diation</h1>
    
    <p>
        Nous recommandons de traiter les vuln√©rabilit√©s selon les priorit√©s suivantes,
        en commen√ßant par les vuln√©rabilit√©s critiques et √©lev√©es qui pr√©sentent les risques les plus importants.
    </p>
    
    <div class="roadmap">
        <div class="timeline">
            {% if summary.critical > 0 %}
            <div class="timeline-item priority-high">
                <h3>Phase 1 - Imm√©diat (0-2 semaines)</h3>
                <p><strong>{{ summary.critical }} vuln√©rabilit√©s critiques</strong></p>
                <p>
                    Correction urgente des vuln√©rabilit√©s critiques qui peuvent permettre une compromission
                    compl√®te du syst√®me ou une fuite de donn√©es sensibles.
                </p>
            </div>
            {% endif %}
            
            {% if summary.high > 0 %}
            <div class="timeline-item priority-high">
                <h3>Phase 2 - Prioritaire (2-4 semaines)</h3>
                <p><strong>{{ summary.high }} vuln√©rabilit√©s √©lev√©es</strong></p>
                <p>
                    Traitement des vuln√©rabilit√©s √©lev√©es qui repr√©sentent un risque significatif
                    pour la s√©curit√© de l'infrastructure.
                </p>
            </div>
            {% endif %}
            
            {% if summary.medium > 0 %}
            <div class="timeline-item priority-medium">
                <h3>Phase 3 - Moyen terme (1-2 mois)</h3>
                <p><strong>{{ summary.medium }} vuln√©rabilit√©s moyennes</strong></p>
                <p>
                    Correction des vuln√©rabilit√©s moyennes dans le cadre d'un plan de renforcement
                    de la posture de s√©curit√© globale.
                </p>
            </div>
            {% endif %}
            
            {% if summary.low > 0 %}
            <div class="timeline-item">
                <h3>Phase 4 - Long terme (2-3 mois)</h3>
                <p><strong>{{ summary.low }} vuln√©rabilit√©s faibles</strong></p>
                <p>
                    Correction des vuln√©rabilit√©s faibles dans le cadre de l'am√©lioration continue
                    de la s√©curit√©.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Appendix -->
{% if include_appendix %}
<div id="appendix" class="appendix section page-break">
    <h1>5. Annexes Techniques</h1>
    
    <h2>5.1. √âchelle de S√©v√©rit√© CVSS</h2>
    <table>
        <thead>
            <tr>
                <th>Score CVSS</th>
                <th>Niveau</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>9.0 - 10.0</td>
                <td><span class="severity-badge critical">Critique</span></td>
                <td>Vuln√©rabilit√© permettant une compromission compl√®te du syst√®me</td>
            </tr>
            <tr>
                <td>7.0 - 8.9</td>
                <td><span class="severity-badge high">√âlev√©e</span></td>
                <td>Vuln√©rabilit√© pr√©sentant un risque significatif pour la s√©curit√©</td>
            </tr>
            <tr>
                <td>4.0 - 6.9</td>
                <td><span class="severity-badge medium">Moyenne</span></td>
                <td>Vuln√©rabilit√© n√©cessitant une attention mais avec impact limit√©</td>
            </tr>
            <tr>
                <td>0.1 - 3.9</td>
                <td><span class="severity-badge low">Faible</span></td>
                <td>Vuln√©rabilit√© avec impact minimal sur la s√©curit√©</td>
            </tr>
        </tbody>
    </table>
    
    <h2>5.2. Outils Utilis√©s</h2>
    <ul>
        {% for tool in statistics.findings_by_tool.keys() %}
        <li>{{ tool }}</li>
        {% endfor %}
    </ul>
    
    <h2>5.3. Glossaire</h2>
    <table>
        <thead>
            <tr>
                <th>Terme</th>
                <th>D√©finition</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>CVE</td>
                <td>Common Vulnerabilities and Exposures - Identifiant unique pour une vuln√©rabilit√© connue</td>
            </tr>
            <tr>
                <td>CVSS</td>
                <td>Common Vulnerability Scoring System - Syst√®me de notation de la s√©v√©rit√© des vuln√©rabilit√©s</td>
            </tr>
            <tr>
                <td>Pentest</td>
                <td>Test d'intrusion - √âvaluation de la s√©curit√© par simulation d'attaque</td>
            </tr>
            <tr>
                <td>Hash</td>
                <td>Empreinte cryptographique d'un mot de passe ou d'une donn√©e</td>
            </tr>
            <tr>
                <td>Active Directory</td>
                <td>Service d'annuaire Microsoft pour la gestion centralis√©e des identit√©s</td>
            </tr>
        </tbody>
    </table>
    
    <h2>5.4. Disclaimer L√©gal</h2>
    <div class="executive-summary">
        <p>
            Ce rapport contient des informations confidentielles destin√©es exclusivement √† <strong>{{ audit_metadata.client_name }}</strong>.
            Toute divulgation, reproduction ou distribution √† des tiers est strictement interdite sans autorisation √©crite pr√©alable.
        </p>
        <p>
            Les informations contenues dans ce rapport refl√®tent l'√©tat de la s√©curit√© au moment de l'audit
            ({{ audit_metadata.audit_date }} - {{ audit_metadata.audit_end_date }}).
        </p>
        <p>
            <strong>Contact:</strong> {{ audit_metadata.contact_client }}
        </p>
    </div>
</div>
{% endif %}

</body>
</html>
